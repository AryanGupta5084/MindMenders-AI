# Sahara (‡§∏‡§π‡§æ‡§∞‡§æ): Your Space to be Heard

Sahara is a **comprehensive, secure, and empathetic mental wellness platform** designed for youth. It combines a **multi-stage AI system** for immediate support with a full suite of tools for proactive wellness, professional help, and peer connection. It is built on a **modern microservice architecture**, ensuring **scalability, privacy, and separation of concerns**.

## ‚ú® Platform Features

Sahara is not a single app but a complete, **multi-portal wellness ecosystem** built on a secure microservice architecture. It consists of a **Main Node.js/Express API**, a separate **Python/Flask AI microservice**, and **Three distinct frontend SPAs** for **users, counselors, and administrators**.

### 1Ô∏è‚É£ Dual-Stage AI & Accessibility System ü§ñ

The platform's intelligence relies on a unique **two-part AI pipeline** to provide **contextual, empathetic, and safe interactions**.

- **Custom Sentiment Analysis:** User input is first sent to a dedicated Python microservice running a custom-trained **BERT model (PyTorch/HuggingFace)** powered by [**Hugging Face Transformers**](https://huggingface.co/transformers/). This model is fine-tuned *specifically* for mental wellness, classifying text into five key categories: `anxiety`, `depression`, `stress`, `suicidal`, or `neutral`.
- **Generative AI Companion:** The main Node.js backend takes this sentiment analysis (e.g., "depression") and injects it into a detailed prompt for the [**Google Gemini API**](https://deepmind.google/technologies/gemini/) (`@google/generative-ai`), instructing it to respond with the appropriate empathy, techniques, and conversational tone.
- **Multi-Language Translation:** The entire chat pipeline is wrapped in a translation utility, allowing users to converse in multiple Indian languages. The system auto-translates user input to English for the AI models, then translates the AI's English response back to the user's native language.
- **Speech-to-Text & Text-to-Speech:** The client-side chat interface integrates the browser's Web Speech API, allowing users to dictate messages via a microphone and have the AI's responses read aloud.
- **Conversational Memory:** The chat controller maintains context by fetching the recent conversation history and appending it to new prompts for the Gemini AI, enabling multi-turn conversational awareness.

### 2Ô∏è‚É£ Privacy, Security & Authentication üîê

Security and privacy are foundational to the platform, with protections at the database, server, and client levels.

- **Database-Level Encryption (AES-256-GCM):** All sensitive user-generated data is encrypted at rest using Node's `crypto` module. Mongoose schemas automatically encrypt content *before* it is saved, ensuring that **journal entries**, **AI chat logs**, and **live counselor chats** are unreadable in the database.
- **JWT Authentication with Server-Side Blocklisting:** The system uses JWTs for authentication but adds a critical security layer. When a user logs out, their token's unique `sessionId` is added to a `blockedSessionIds` array on their User document. The `protect` middleware validates every request against this database array, instantly invalidating any logged-out token, even if it hasn't expired.
- **Dual User System & Automatic Data Purging:** The platform supports both full registered accounts (with `bcryptjs` hashed passwords) and a "Continue as Guest" mode. All guest accounts‚Äîand their associated encrypted chat data‚Äîare automatically and permanently deleted from the database after 7 days using a **MongoDB TTL (Time-To-Live) Index** on the `expireAt` field.
- **Role-Based Access Control (RBAC):** Admin routes are protected by a dedicated `isAdmin` middleware that performs a fresh database check on *every request* to verify admin status, rather than trusting the (potentially outdated) claims within the JWT.
- **Secure API & Server:** The Express server implements `helmet` for secure HTTP headers (including a Content Security Policy), `express-rate-limit` to prevent API abuse, and a strict CORS policy controlled via environment variables.

### 3. User Wellness Toolkit

These are the core interactive features available to registered users through the main application.

- **Private Daily Journal:** An encrypted, one-entry-per-day journal system (enforced by a unique compound database index) that allows users to record their mood and thoughts.
- **Gamification (Wellness Streak):** The platform gamifies positive habits by tracking a user's consecutive daily journal entries, storing a `journalStreak` on the User model, and unlocking achievements.
- **Personal Analytics Dashboard:** A "My Progress" modal that uses **Chart.js** to render visualizations of a user's wellness data. This data is generated by backend Mongoose aggregation pipelines that analyze the user's mood and journal sentiment history.
- **Standardized Screening Tools:** Provides clinically-recognized questionnaires (PHQ-9 for depression, GAD-7 for anxiety), which are auto-seeded into the database on startup. The system scores user submissions against the test's rules and provides a clear interpretation and recommendation.
- **AI-Guided Interactive Exercises:** A library of structured CBT and Mindfulness exercises. This feature uses the Gemini AI as a conversational guide to provide validating, transitional phrases between each step, transforming a static form into an interactive therapy session.
- **Offline PWA Functionality:** As a full Progressive Web App, the platform caches its core "app shell" (HTML/CSS/JS) and dynamic content (like wellness resources), allowing users to access the app and cached information even without an internet connection.
- **Wellness Resource Hub:** A curated library of articles, videos, and audio content, filterable by language and tags.

### 4. Human Connection: Counselors & Community

The platform connects users with professionals and peers through a complete scheduling and communication suite.

- **Counselor Booking System:** A multi-step UI allows users to view counselor profiles (managed by the admin), check their weekly availability, and book an appointment in an available time slot.
- **Transaction-Safe Scheduling:** The booking endpoint is built to prevent race conditions. It uses a **Mongoose Database Transaction** to atomically check for slot availability *and* create the new appointment, making it impossible for two users to book the same slot at the same millisecond.
- **Automated Calendar Invites:** Upon a successful booking, the server uses `nodemailer` and the `ics` library to automatically generate and email an `.ics` calendar file invitation to both the user and the counselor.
- **Private, Real-Time Sessions:** The platform facilitates live appointments via a secure, real-time chat powered by **Socket.IO**.
- **Secure Socket Authentication:** All socket connections are authenticated via JWT. The server handler then verifies that the authenticated user is a valid participant (either the patient or the *correct* counselor) for that specific appointment ID before allowing them to join the Socket.IO room, ensuring total session privacy.
- **Anonymous Community Forum:** A peer-support forum where users can create posts and comments with an "Post Anonymously" toggle. When checked, the backend controller intercepts the request and masks the user's identity, displaying "Anonymous" to all other users.
- **Spam-Proof Reporting:** Users can report any post or comment for moderation. The backend uses MongoDB's **`$addToSet`** operator to add the user's ID to a `reports` array, which atomically prevents the same user from spam-reporting the same content multiple times.

### 5. Platform Management (Admin & Counselor Portals)

The project includes two additional, separate applications for platform operation, served from the same backend.

- **Comprehensive Admin Panel:** A secure, dedicated SPA (`admin.html`) that provides full administrative control over the entire application. Admins can perform full CRUD operations on Users, Counselors, Wellness Resources, Appointments, and Forum content.
- **Scalable Admin UI (Server-Side Logic):** The admin dashboard is built to scale, using **server-side pagination and search** for all data tables. This is powered by complex backend Mongoose aggregation pipelines (`$lookup`, `$match`, etc.) to ensure the UI remains fast and responsive, even with millions of database records.
- **Transactional Cascading Deletes:** The admin panel features robust data integrity. When an admin deletes a high-level entity (like a User), the backend triggers a database transaction to atomically delete *all* associated content (posts, comments, appointments, chats, etc.), preventing any orphaned data.
- **Dedicated Counselor Dashboard:** A separate, secure portal (`counselor.html`) where verified counselors can log in to manage their professional profile, set their weekly availability schedule (which feeds the booking engine), and join their scheduled real-time chat sessions with patients.
- **Global Analytics View:** The admin dashboard features charts for platform-wide analytics, like global user mood distribution.

## üõ† Tech Stack

- **Backend:** Node.js, Express.js, Socket.io (for real-time chat)
- **Frontend:** HTML5, CSS3, Vanilla JavaScript (SPA architecture)
- **AI/ML:**
  - **Sentiment Analysis:** Python, Flask, PyTorch, HuggingFace Transformers (BERT)
  - **Generative AI:** Google Gemini (via `@google/generative-ai`)
- **Database:** MongoDB (with Mongoose ODM)
- **Authentication:** JSON Web Tokens (JWT)

## üìÅ Project Structure

```
sahara/
‚îú‚îÄ‚îÄ config/                 # Configuration files
‚îú‚îÄ‚îÄ app.js                  # Main Express server with Socket.io integration
‚îú‚îÄ‚îÄ controllers/            # Business logic for all features (chat, booking, journal, etc.)
‚îú‚îÄ‚îÄ middleware/             # Authentication and Admin authorization
‚îú‚îÄ‚îÄ models/                 # Mongoose schemas for all data structures
‚îú‚îÄ‚îÄ public/                 # Frontend SPAs (user, admin, counselor)
‚îú‚îÄ‚îÄ routes/                 # API route definitions for all features
‚îú‚îÄ‚îÄ sentiment_service/      # Self-contained Python/Flask sentiment microservice
‚îú‚îÄ‚îÄ socket/                 # Socket.io connection and event handling logic [Note: This is socketHandler.js]
‚îú‚îÄ‚îÄ utils/                  # Helper utilities (encryption, translation, etc.)
‚îú‚îÄ‚îÄ .env.example            # Environment variables (Example)
‚îî‚îÄ‚îÄ package.json            # Node.js dependencies and scripts
```


## ‚ö°Ô∏è Quick Start

### 1. Prerequisites

- Node.js & npm
- Python & pip
- MongoDB instance (local or cloud)

### 2. Setup

Clone the repository and install dependencies for both the Node.js server and the Python service.

```bash
# Install Node.js dependencies
npm install

# Install Python dependencies
cd sentiment_service
pip install -r requirements.txt
python download_nltk_data.py
cd ..
```

### 3. Environment Variables

Create a `.env` file in the root directory and populate it with your configuration (MongoDB URI, API keys, secrets).

### 4. Run the Application

You can use the provided PowerShell script (for Windows) to launch both services with a health check.

```bash
# This script starts the Python service, waits for it to be ready, then starts the Node server.
./start.ps1
```

Alternatively, run each service in a separate terminal:

```bash
# Terminal 1: Start the Sentiment Service
npm run sentiment-service

# Terminal 2: Start the Node.js Backend
npm run dev
```

### üöÄ 5. Access the App  

- **Main App:** [http://localhost:5000](http://localhost:5000)  
- **Admin Panel:** [http://localhost:5000/admin.html](http://localhost:5000/admin.html)  
- **Counselor Dashboard:** [http://localhost:5000/counselor.html](http://localhost:5000/counselor.html)  

## üìå API Endpoints (Summary)

- **Authentication:** `POST /api/users/register`, `POST /api/users/login`, `POST /api/users/guest`
- **AI Chat:** `POST /api/chat/message`, `GET /api/chat/history`, `GET /api/chat/sessions`
- **Booking:** `GET /api/booking/counselors`, `GET /api/booking/slots/:id`, `POST /api/booking/appointments`, `GET /api/booking/my-appointments`
- **Forum:** `GET /api/forum/posts`, `POST /api/forum/posts`, `POST /api/forum/posts/:id/comments`
- **Journaling:** `GET /api/journal`, `POST /api/journal`, `GET /api/journal/stats`
- **Exercises:** `GET /api/exercises`, `POST /api/exercises/start`
- **Resources:** `GET /api/resources`
- **Counselor:** `GET /api/counselors/my-appointments`
- **Admin:** Full CRUD and management routes under `/api/admin/...`

## üÜò Crisis Response

The chatbot includes an automated crisis detection system that:

- Identifies potential suicidal ideation via the custom sentiment model.
- Immediately provides localized helpline information within the chat response.
- Flags the conversation in the database for potential review by administrators.

## üôè Acknowledgments  

This platform stands on the shoulders of giants. Acknowledgments to:  

- [Google Gemini](https://deepmind.google/technologies/gemini/) for generative AI capabilities.  
- [Hugging Face Transformers](https://huggingface.co/transformers/) for the underlying BERT model and tokenizer.  
- [MongoDB](https://www.mongodb.com/) for the flexible database solution.  

## ‚öñÔ∏è License

This project is licensed under the **MIT License**. See the full license text in the [LICENSE.txt](LICENSE.txt) file for details.
